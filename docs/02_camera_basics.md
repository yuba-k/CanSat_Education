# カメラ制御実装
## ライブラリについて
今回のカメラ制御にあたって使用しているライブラリはpicamera2とdatetimeの2つである．
### picamera2
picamera2はRaspberry Piのカメラモジュールを制御するためのPythonライブラリである．<br>
主な機能として，カメラモジュールからの映像取得，静止画や動画の撮影，デジタルズームなどの画像処理といった機能がある．
### datetime
プログラムで日付や時間を扱うときに使うPythonのライブラリである．<br>
主な機能として，現在時刻や日付の取得，日時の差（比較），日時の加算・減算（時間計算）などの機能がある．
## カメラインスタンスの作成
```py
picam2 = Picamera2()
```
これで`picamera2`のインスタンスを作成している．<br>
ライブラリで読み込んだPicamera2はまだ設計図の段階で使うことはできない．そのため実体を与えるためインスタンスを作成する必要がある．<br>
これがカメラを操作するメインのオブジェクトである．
## 解像度設定
```py
config = picam2.create_still_configuration(main={"size": (width, height)})
picam2.configure(config)
```
このプログラムは写真を撮る際に必要な設定を行うプログラムである．<br>
`create_still_configuration()`で静止画用の設定を作成する．<br>
`main={"size": (width, height)}`で解像度を指定しする。ここでの解像度は関数の引数で与えられた引数を入れる．そしてこの設定を`config`に格納する．<br>
`picam2.configure(config)`で設定をカメラに適用する．
## カメラ起動
```py
picam2.start()
```
これまで行ってきたのは設定なのでまだカメラ自体は使えない．そのためこのプログラムによってカメラを起動させる．
## 画像のファイル名の作成
```py
filename = f"{cnt}_{datetime.now().strftime('%Y%m%d_%H%M%S%f')[:-4]}.jpg"
```
`examples\02_camera_basics\camera.py`の課題1はこのようになる．<br>
`{cnt}`で関数の引数に与えられた数が入る．<br>
`datetime.now()`は現在の日時を取得している．先程のdatetimeモジュールから呼び出している．<br>
`strftime()`は`datetime.now()`で取得した日時を文字列として表示する関数．各指定子の意味は以下の表の通り．<br>
|指定子|意味|
|-|-|
|`%Y`|西暦（4桁）|
|`%m`|月（2桁）|
|`%d`|日（2桁）|
|`%H`|時（24時）|
|`%M`|分|
|`%S`|秒|
|`%f`|マイクロ秒（6桁）|

`[:-4]`は文字列の末尾を削除する操作で今回のプログラムではマイクロ秒の下4桁を削除している．<br>
`.jpg`最後に画像ファイルの拡張子を指定している．
## 撮影と保存
```py
picam2.capture_file(filename)
```
`picam2.capture_file()`で撮影と保存を行っている．保存名として`filename`が与えられている．
## カメラの終了
```py
picam2.close()
```
`picam2.close()`によってカメラの終了をし，リソースを解放している．プログラム実行時に必ず行う．
## プログラムの実行
`assignments\week03_camera_basics.md`にある課題2で書いた通りこれだけでは実行することができない．関数を実行するためには以下のプログラムなどで実行する．
```py
# --- 使用例 ---
if __name__ == "__main__":
    capture(1080, 1920, 1)  # 高さ1080, 幅1920 の解像度で撮影（1枚目）
```
#### 課題
+α：実行したとき連続して5枚写真を撮影するプログラムを作ってみよう．
```
――実行結果（例）――
1_20251109_21304512.jpg
2_20251109_21304684.jpg
3_20251109_21304731.jpg
4_20251109_21304810.jpg
5_20251109_21304898.jpg
```
picamera2のマニュアルを見てみよう．